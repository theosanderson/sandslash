import pandas as pd
assignments = pd.read_csv(
    "https://raw.githubusercontent.com/cov-lineages/pango-designation/master/lineages.csv"
)

metadata = pd.read_csv("../metadata.tsv", sep="\t")
interesting = set(assignments['taxon'].to_list())

lookup = dict(zip(metadata["Accession ID"], metadata["Virus name"]))

from Bio import SeqIO
import cov2_genome
"""The masks below are from an arbitrary sequence - there may be too many sites masked here, fix"""
masked = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
    21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
    40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58,
    59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,
    78, 79, 80, 81, 82, 83, 149, 152, 634, 1706, 1894, 2090, 2093, 2197, 2603,
    3144, 3563, 3638, 3777, 4049, 4220, 5010, 5256, 5735, 5742, 5743, 6166,
    6254, 6868, 6873, 8021, 8025, 8327, 8789, 8826, 8827, 8885, 8886, 9038,
    10128, 10238, 10553, 10715, 11073, 11082, 11534, 13116, 13401, 13407,
    13475, 13570, 13598, 13686, 14221, 14222, 14224, 14276, 14850, 14851,
    15434, 15921, 16289, 16886, 17177, 17178, 17181, 17566, 19285, 19297,
    19298, 19483, 19547, 20055, 20122, 20464, 21148, 21150, 21208, 21211,
    21549, 21550, 21574, 21967, 21986, 22334, 22515, 22520, 22650, 22660,
    22801, 24388, 24389, 24621, 24932, 25201, 25380, 25381, 26548, 27657,
    27659, 27759, 27760, 27783, 28183, 28252, 28984, 29036, 29038, 29057,
    29424, 29552, 29593, 29782, 29803, 29804, 29805, 29806, 29807, 29808,
    29809, 29810, 29811, 29812, 29813, 29814, 29815, 29816, 29817, 29818,
    29819, 29820, 29821, 29822, 29823, 29824, 29825, 29826, 29827, 29828,
    29829, 29830, 29831, 29832, 29833, 29834, 29835, 29836, 29837, 29838,
    29839, 29840, 29841, 29842, 29843, 29844, 29845, 29846, 29847, 29848,
    29849, 29850, 29851, 29852, 29853, 29854, 29855, 29856, 29857, 29858,
    29859, 29860, 29861, 29862, 29863, 29864, 29865, 29866, 29867, 29868,
    29869, 29870, 29871, 29872, 29873, 29874, 29875, 29876, 29877, 29878,
    29879, 29880, 29881, 29882, 29883, 29884, 29885, 29886, 29887, 29888,
    29889, 29890
}

for record in SeqIO.parse("../mmsa_2021-08-31/2021-08-31_masked.fa", 'fasta'):
    if record.id in lookup:
        if lookup[record.id].replace("hCoV-19/", "") in interesting:
            diffs = []
            for position in range(len(record.seq)):
                if position not in masked and record.seq[
                        position] != cov2_genome.seq[position]:
                    diffs.append(str(position) + ":" + record.seq[position])
            print(record.id + "\t" + ",".join(diffs))
        else:
            pass